# 工程管理模块

## 功能描述

工程管理模块负责综合复盘软件中工程（项目）的创建、打开、关闭、信息展示、数据集管理等核心功能。其主要目标是为用户提供高效、可靠的工程级数据组织与管理能力，支撑后续的数据回放、分析与可视化。

主要功能包括：

- 新建工程：创建新的工程目录和基础结构，生成工程配置文件。
- 打开工程：选择并加载已有工程目录，解析工程元数据。
- 关闭工程：释放资源，清理当前工程状态。
- 显示工程信息：展示工程名称、路径、文件数量、总时长、数据集等信息。
- 扫描工程结构：自动识别工程下的数据集及其PCAP文件。
- 数据集管理：支持数据集的创建、导入、移除、统计与选择。

## 核心流程

1. 新建工程
   - 用户指定工程目录和名称，系统生成基础目录结构和配置文件（.pproj）。
   - 初始化空的数据集列表。
2. 打开工程
   - 用户选择工程目录，系统查找并加载工程配置文件。
   - 扫描工程目录下的数据集，统计PCAP文件数量、时长等元数据。
   - 构建工程信息对象，供前端展示。
3. 关闭工程
   - 清理内存中的工程状态，释放相关资源。
4. 数据集管理
   - 支持在工程下新建、导入、移除数据集。
   - 每个数据集包含若干PCAP文件及索引文件（.pidx）。
   - 支持统计数据集文件数量、总大小、时长等。

## 数据结构设计

### 工程信息（ProjectInfo）

| 字段名         | 类型                 | 说明                |
| -------------- | -------------------- | ------------------- |
| name           | String               | 工程名称            |
| path           | String               | 工程目录路径        |
| total_duration | u64/number           | 总时长（纳秒）      |
| file_count     | usize/number         | 文件数量            |
| start_time     | String               | 开始时间（ISO格式） |
| end_time       | String               | 结束时间（ISO格式） |
| metadata       | ProjectMetadata      | 工程元数据          |
| pcap_files     | Vec<String>/string[] | PCAP文件路径列表    |

### 工程元数据（ProjectMetadata）

| 字段名       | 类型                  | 说明     |
| ------------ | --------------------- | -------- |
| version      | String                | 工程版本 |
| description  | Option<String>/string | 工程描述 |
| tags         | Vec<String>/string[]  | 标签列表 |
| participants | Vec<String>/string[]  | 参与人   |

### 数据集信息（DatasetInfo）

| 字段名          | 类型         | 说明                 |
| --------------- | ------------ | -------------------- |
| name            | String       | 数据集名称           |
| path            | String       | 数据集路径           |
| file_count      | usize/number | 文件数量             |
| total_packets   | u64/number   | 数据包总数           |
| total_size      | u64/number   | 数据集总大小（字节） |
| start_timestamp | Option<u64>  | 开始时间戳（纳秒）   |
| end_timestamp   | Option<u64>  | 结束时间戳（纳秒）   |
| created_time    | String       | 创建时间             |
| modified_time   | String       | 最后修改时间         |
| has_index       | bool         | 是否包含索引文件     |

### 文件信息（FileInfo）

| 字段名          | 类型           | 说明               |
| --------------- | -------------- | ------------------ |
| file_name       | String         | 文件名             |
| file_path       | String         | 文件路径           |
| file_size       | u64/number     | 文件大小（字节）   |
| packet_count    | u64/number     | 数据包数量         |
| start_timestamp | Option<u64>    | 开始时间戳（纳秒） |
| end_timestamp   | Option<u64>    | 结束时间戳（纳秒） |
| file_hash       | Option<String> | 文件哈希           |
| created_time    | String         | 创建时间           |
| modified_time   | String         | 最后修改时间       |
| is_valid        | bool           | 是否有效           |

### 工程配置（PprojConfig）

| 字段名              | 类型               | 说明                 |
| ------------------- | ------------------ | -------------------- |
| version             | String             | 配置版本             |
| name                | String             | 工程名称             |
| description         | Option<String>     | 工程描述             |
| created_time        | String             | 创建时间             |
| modified_time       | String             | 最后修改时间         |
| datasets            | Vec<DatasetConfig> | 数据集配置列表       |
| project_name        | String             | 工程名称（兼容字段） |
| project_description | Option<String>     | 工程描述（兼容）     |
| author              | Option<String>     | 作者                 |
| tags                | Vec<String>        | 标签列表             |

### 数据集配置（DatasetConfig）

| 字段名         | 类型           | 说明       |
| -------------- | -------------- | ---------- |
| name           | String         | 数据集名称 |
| description    | Option<String> | 数据集描述 |
| path           | String         | 数据集路径 |
| network_config | NetworkConfig  | 网络配置   |

### 网络配置（NetworkConfig）

| 字段名       | 类型           | 说明                       |
| ------------ | -------------- | -------------------------- |
| network_type | String         | 网络类型（单播/组播/广播） |
| ip_address   | String         | IP地址                     |
| port         | u16/number     | 端口号                     |
| interface    | Option<String> | 网卡接口                   |

## 前后端交互说明

- 前端通过Tauri命令与后端交互，获取和展示工程、数据集、文件等信息。
- 工程信息、数据集信息、文件信息等均采用结构化数据对象进行传递。
- 工程配置文件（.pproj）采用JSON或XML格式存储，包含所有元数据和数据集配置。

## 典型工程目录结构

```
/path/to/project/
├── data-set-01/
│   ├── data_20240101_000001.pcap
│   ├── data_20240101_000002.pcap
│   └── data-set-01.pidx
├── data-set-02/
│   ├── data_20240101_000003.pcap
│   └── data-set-02.pidx
└── project.pproj
```

## 设计要点

- 工程与数据集分层管理，支持多数据集、多文件组织。
- 支持工程元数据、标签、参与人等扩展信息。
- 数据集支持网络配置，便于后续网络回放。
- 采用表格描述数据结构，便于前后端一致性实现。
